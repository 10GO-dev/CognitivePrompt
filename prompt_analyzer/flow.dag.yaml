inputs:
  chat_history:
    type: string
    default: ""
  question:
    type: string
    default: |-
      402-1933423-8

      829-389-3232
  profile:
    type: string
    default: medicine
  document:
    type: list
    default: []
outputs:
  question:
    type: string
    reference: ${inputs.question}
  profile:
    type: string
    reference: ${inputs.profile}
nodes:
- name: FilterConfig
  type: python
  source:
    type: code
    path: FilterConfig.py
  inputs:
    question: ${inputs.question}
    profile: ${inputs.profile}
- name: PromptHarmCategoriesFIlter
  type: python
  source:
    type: package
    tool: promptflow.tools.azure_content_safety.analyze_text
  inputs:
    connection: ai-ddpm0001ai1418328216884502
    text: ${inputs.question}
    hate_category: ${FilterConfig.output.hate}
    self_harm_category: ${FilterConfig.output.self_harm}
    sexual_category: ${FilterConfig.output.sexual}
    violence_category: ${FilterConfig.output.violence}
  activate:
    when: ${prompt_shield.output.attackDetected}
    is: false
- name: prompt_shield
  type: python
  source:
    type: code
    path: prompt_shield.py
  inputs:
    connection: ai-ddpm0001ai1418328216884502
    user_prompt: ${inputs.question}
    documents: ${inputs.document}
- name: GrammarNCoherence
  type: python
  source:
    type: code
    path: GrammarNCoherence.py
  inputs:
    question: ${inputs.question}
    profile: ${inputs.profile}
    conn: DeepSeek-V3
  activate:
    when: ${PromptHarmCategoriesFIlter.output.suggested_action}
    is: Accept
- name: PII_recognition
  type: python
  source:
    type: code
    path: PII_recognition.py
  inputs:
    conn: ai-ddpm0001ai1418328216884502
    user_input: ${inputs.question}
